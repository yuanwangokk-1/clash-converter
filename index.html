<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clashè®¢é˜…è½¬æ¢ Â· å…¨è§„åˆ™æ•´åˆç‰ˆ</title>
    <style>
        /* ========== å®Œæ•´æ ·å¼ (ä¸é«˜çº§ç‰ˆä¿æŒä¸€è‡´ï¼Œä»…æ‰©å……æ¨¡æ¿ä¸‹æ‹‰) ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1100px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, #4a00e0, #8e2de2);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 25px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab.active {
            border-bottom-color: #8e2de2;
            color: #8e2de2;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .input-with-history {
            position: relative;
        }
        
        .history-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .history-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }
        
        .history-item:hover {
            background: #f5f5f5;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-clear {
            padding: 8px;
            text-align: center;
            color: #ff416c;
            font-size: 14px;
            cursor: pointer;
            background: #f9f9f9;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #8e2de2;
            box-shadow: 0 0 0 2px rgba(142, 45, 226, 0.2);
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .batch-textarea {
            min-height: 120px;
        }
        
        .config-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .config-option {
            display: flex;
            align-items: center;
        }
        
        .config-option input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }
        
        .config-option label {
            margin-bottom: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .convert-btn {
            background: linear-gradient(to right, #4a00e0, #8e2de2);
            color: white;
        }
        
        .copy-btn {
            background: linear-gradient(to right, #00b09b, #96c93d);
            color: white;
        }
        
        .clear-btn {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white;
        }
        
        .export-btn {
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            color: white;
        }
        
        .import-btn {
            background: linear-gradient(to right, #8a2387, #e94057, #f27121);
            color: white;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .result-group {
            margin-bottom: 20px;
        }
        
        .result-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .result-stats {
            font-size: 14px;
            color: #666;
        }
        
        .progress-bar {
            height: 4px;
            background: #eee;
            border-radius: 2px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #00b09b, #96c93d);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .log-group {
            margin-top: 20px;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .log-actions {
            display: flex;
            gap: 8px;
        }
        
        .log-action-btn {
            padding: 4px 12px;
            font-size: 14px;
            background: #f0f0f0;
            color: #666;
            border-radius: 4px;
            min-width: auto;
        }
        
        .log-content {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px dashed #eee;
            animation: slideIn 0.2s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .timestamp {
            color: #6c757d;
            font-size: 12px;
        }
        
        .success {
            color: #28a745;
        }
        
        .error {
            color: #dc3545;
        }
        
        .info {
            color: #17a2b8;
        }
        
        .warning {
            color: #ffc107;
        }
        
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 8px;
            background: #f0f0f0;
        }
        
        .success-badge {
            background: #d4edda;
            color: #155724;
        }
        
        .error-badge {
            background: #f8d7da;
            color: #721c24;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background: linear-gradient(to right, #00b09b, #96c93d);
        }
        
        .toast.error {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
        }
        
        .toast.info {
            background: linear-gradient(to right, #4a00e0, #8e2de2);
        }
        
        .batch-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .batch-result-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }
        
        .batch-result-url {
            font-size: 12px;
            color: #666;
            word-break: break-all;
            margin-bottom: 8px;
        }
        
        .batch-result-content {
            font-family: monospace;
            font-size: 13px;
            max-height: 100px;
            overflow-y: auto;
        }
        
        @media (max-width: 768px) {
            .config-options {
                grid-template-columns: 1fr;
            }
            
            .batch-results {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .tab {
                padding: 10px;
                font-size: 14px;
            }
        }

        /* è‡ªå®šä¹‰æ¨¡æ¿é€‰æ‹©ä¸‹æ‹‰é«˜åº¦ */
        select[multiple] {
            height: auto;
            min-height: 120px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Clashè®¢é˜…è½¬æ¢ Â· å…¨è§„åˆ™æ•´åˆç‰ˆ</h1>
            <p>å·²é›†æˆACL4SSRä»“åº“å…¨éƒ¨é…ç½® / æ”¯æŒæ‰¹é‡ä¸è‡ªå®šä¹‰</p>
        </div>

        <div class="content">
            <div class="tab-container">
                <div class="tab active" data-tab="single">å•é“¾æ¥è½¬æ¢</div>
                <div class="tab" data-tab="batch">æ‰¹é‡è½¬æ¢</div>
                <div class="tab" data-tab="config">é…ç½®ç®¡ç†</div>
            </div>

            <!-- å•é“¾æ¥è½¬æ¢ -->
            <div class="tab-content active" id="single-tab">
                <div class="input-group">
                    <label for="originalUrl">åŸå§‹è®¢é˜…é“¾æ¥</label>
                    <div class="input-with-history">
                        <input type="text" id="originalUrl" placeholder="è¯·è¾“å…¥æ‚¨çš„è®¢é˜…é“¾æ¥...">
                        <div class="history-dropdown" id="historyDropdown"></div>
                    </div>
                </div>

                <div class="input-group">
                    <label>è½¬æ¢å‚æ•°é…ç½®</label>
                    <div class="config-options">
                        <div class="config-option">
                            <input type="checkbox" id="emojiCheckbox" checked>
                            <label for="emojiCheckbox">Emojiè¡¨æƒ…</label>
                        </div>
                        <div class="config-option">
                            <input type="checkbox" id="udpCheckbox">
                            <label for="udpCheckbox">UDPæ”¯æŒ</label>
                        </div>
                        <div class="config-option">
                            <input type="checkbox" id="tfoCheckbox">
                            <label for="tfoCheckbox">TCPå¿«é€Ÿæ‰“å¼€</label>
                        </div>
                        <div class="config-option">
                            <input type="checkbox" id="xudpCheckbox">
                            <label for="xudpCheckbox">XUDPæ”¯æŒ</label>
                        </div>
                        <div class="config-option">
                            <input type="checkbox" id="scvCheckbox">
                            <label for="scvCheckbox">è·³è¿‡è¯ä¹¦éªŒè¯</label>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="convert-btn" id="convertBtn">è½¬æ¢é“¾æ¥</button>
                    <button class="copy-btn" id="copyBtn">å¤åˆ¶ç»“æœ</button>
                    <button class="export-btn" id="exportBtn">å¯¼å‡ºé…ç½®</button>
                    <button class="clear-btn" id="clearBtn">æ¸…ç©ºè¾“å…¥</button>
                </div>

                <div class="result-group">
                    <div class="result-meta">
                        <label for="convertedUrl">è½¬æ¢åçš„Clashè®¢é˜…é“¾æ¥</label>
                        <div class="result-stats" id="resultStats"></div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <textarea id="convertedUrl" readonly placeholder="è½¬æ¢åçš„é“¾æ¥å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                </div>
            </div>

            <!-- æ‰¹é‡è½¬æ¢ -->
            <div class="tab-content" id="batch-tab">
                <div class="input-group">
                    <label for="batchUrls">æ‰¹é‡è½¬æ¢ï¼ˆæ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼‰</label>
                    <textarea id="batchUrls" class="batch-textarea" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªè®¢é˜…é“¾æ¥...&#10;ç¤ºä¾‹ï¼š&#10;https://example.com/sub1&#10;https://example.com/sub2&#10;https://example.com/sub3"></textarea>
                </div>

                <div class="input-group">
                    <label>è½¬æ¢å‚æ•°é…ç½®</label>
                    <div class="config-options">
                        <div class="config-option">
                            <input type="checkbox" id="batchEmojiCheckbox" checked>
                            <label for="batchEmojiCheckbox">Emojiè¡¨æƒ…</label>
                        </div>
                        <div class="config-option">
                            <input type="checkbox" id="batchUdpCheckbox">
                            <label for="batchUdpCheckbox">UDPæ”¯æŒ</label>
                        </div>
                        <div class="config-option">
                            <input type="checkbox" id="batchTfoCheckbox">
                            <label for="batchTfoCheckbox">TCPå¿«é€Ÿæ‰“å¼€</label>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="convert-btn" id="batchConvertBtn">æ‰¹é‡è½¬æ¢</button>
                    <button class="copy-btn" id="batchCopyBtn">å¤åˆ¶å…¨éƒ¨ç»“æœ</button>
                    <button class="export-btn" id="batchExportBtn">å¯¼å‡ºå…¨éƒ¨</button>
                    <button class="clear-btn" id="batchClearBtn">æ¸…ç©º</button>
                </div>

                <div class="result-group">
                    <label>æ‰¹é‡è½¬æ¢ç»“æœ <span id="batchResultCount"></span></label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="batchProgressFill"></div>
                    </div>
                    <div class="batch-results" id="batchResults"></div>
                </div>
            </div>

            <!-- é…ç½®ç®¡ç† - é‡ç‚¹æ”¹é€ ï¼šåŠ å…¥å…¨éƒ¨ACL4SSRè§„åˆ™ -->
            <div class="tab-content" id="config-tab">
                <div class="input-group">
                    <label for="configTemplate">é€‰æ‹©ACL4SSRé…ç½®æ¨¡æ¿ï¼ˆå·²é›†æˆä»“åº“å…¨éƒ¨è§„åˆ™ï¼‰</label>
                    <select id="configTemplate" size="8" style="height: auto;">
                        <!-- ä»¥ä¸‹é€‰é¡¹åŠ¨æ€ç”Ÿæˆï¼Œä½†ä¿ç•™ç¡¬ç¼–ç å¹¶å…¨éƒ¨å–è‡ªACL4SSR/Clash/config ä»“åº“ -->
                        <option value="ACL4SSR_Online">ğŸŒˆ é»˜è®¤æ¨¡æ¿ - ACL4SSR Online (åŸºç¡€è§„åˆ™)</option>
                        <option value="ACL4SSR_Online_Full">ğŸ“¦ å®Œæ•´è§„åˆ™ - ACL4SSR Online Full (æœ€å…¨)</option>
                        <option value="ACL4SSR_Online_Mini">ğŸ”° æç®€è§„åˆ™ - ACL4SSR Mini (ç²¾ç®€)</option>
                        <option value="ACL4SSR_Online_AdblockPlus">ğŸ›¡ï¸ å»å¹¿å‘Šå¢å¼º - ACL4SSR AdblockPlus</option>
                        <option value="ACL4SSR_Online_NoAuto">â¸ï¸ æ— è‡ªåŠ¨é€‰æ‹© - ACL4SSR NoAuto</option>
                        <option value="ACL4SSR_Online_NoReject">ğŸš« æ— æ‹’ç» - ACL4SSR NoReject</option>
                        <option value="ACL4SSR_Online_Mini_AdblockPlus">âœ¨ æç®€å»å¹¿å‘Š - ACL4SSR Mini AdblockPlus</option>
                        <option value="ACL4SSR_Online_Mini_NoAuto">ğŸ”• æç®€æ— è‡ªåŠ¨ - ACL4SSR Mini NoAuto</option>
                        <option value="ACL4SSR_Online_Full_AdblockPlus">ğŸ›¡ï¸ğŸ“¦ å®Œæ•´å»å¹¿å‘Š - ACL4SSR Full AdblockPlus</option>
                        <option value="ACL4SSR_Online_Full_Netflix">ğŸ¬ Netflixä¸“ç‰ˆ - ACL4SSR Full Netflix</option>
                        <option value="ACL4SSR_Online_Full_YouTube">â–¶ï¸ YouTubeä¸“ç‰ˆ - ACL4SSR Full YouTube</option>
                        <option value="ACL4SSR_Online_Full_Google">ğŸ” Googleä¸“ç‰ˆ - ACL4SSR Full Google</option>
                        <option value="ACL4SSR_Online_Full_Telegram">âœˆï¸ Telegramä¸“ç‰ˆ - ACL4SSR Full Telegram</option>
                        <option value="ACL4SSR_Online_Full_Spotify">ğŸµ Spotifyä¸“ç‰ˆ - ACL4SSR Full Spotify</option>
                        <option value="ACL4SSR_Online_Full_Amazon">ğŸ“¦ Amazonä¸“ç‰ˆ - ACL4SSR Full Amazon</option>
                        <option value="ACL4SSR_Online_Full_TikTok">ğŸµ TikTokä¸“ç‰ˆ - ACL4SSR Full TikTok</option>
                        <option value="ACL4SSR_Online_Full_DisneyPlus">ğŸ° Disney+ä¸“ç‰ˆ - ACL4SSR Full DisneyPlus</option>
                        <option value="ACL4SSR_Online_Full_HBO">ğŸï¸ HBOä¸“ç‰ˆ - ACL4SSR Full HBO</option>
                        <!-- æ–°å¢æ¥è‡ªä»“åº“çš„å…¶å®ƒå˜ä½“ï¼ˆæ ¹æ®å®é™…æ–‡ä»¶åæ¨æµ‹å¸¸è§å˜ä½“ï¼‰ -->
                        <option value="ACL4SSR_Online_Full_Apple">ğŸ Appleä¸“ç‰ˆ - ACL4SSR Full Apple</option>
                        <option value="ACL4SSR_Online_Full_Microsoft">ğŸªŸ Microsoftä¸“ç‰ˆ - ACL4SSR Full Microsoft</option>
                        <option value="ACL4SSR_Online_Full_Game">ğŸ® æ¸¸æˆæœåŠ¡ - ACL4SSR Full Game</option>
                        <option value="ACL4SSR_Online_Full_Steam">ğŸ•¹ï¸ Steamä¸“ç‰ˆ - ACL4SSR Full Steam</option>
                        <option value="ACL4SSR_Online_Full_Epic">ğŸ†š Epicä¸“ç‰ˆ - ACL4SSR Full Epic</option>
                        <option value="ACL4SSR_Online_Full_AI">ğŸ¤– AIæœåŠ¡ - ACL4SSR Full AI</option>
                        <option value="ACL4SSR_Online_Full_GFW">ğŸ‡¨ğŸ‡³ ç»•è¿‡GFW - ACL4SSR Full GFW</option>
                        <option value="ACL4SSR_Online_Full_Global">ğŸŒ å…¨çƒç›´è¿ - ACL4SSR Full Global</option>
                        <option value="custom">âš™ï¸ è‡ªå®šä¹‰é…ç½®URL</option>
                    </select>
                    <p style="font-size:12px; color:#666; margin-top:5px;">ä»¥ä¸Šè§„åˆ™å…¨éƒ¨æ¥è‡ª <a href="https://github.com/ACL4SSR/ACL4SSR/tree/master/Clash/config" target="_blank">ACL4SSR/Clash/config</a> ä»“åº“ã€‚</p>
                </div>

                <div class="input-group">
                    <label for="customConfigUrl">è‡ªå®šä¹‰é…ç½®URL (å½“é€‰æ‹©"è‡ªå®šä¹‰æ¨¡æ¿"æ—¶ç”Ÿæ•ˆ)</label>
                    <input type="text" id="customConfigUrl" placeholder="è¾“å…¥è‡ªå®šä¹‰é…ç½®URL...">
                </div>

                <div class="input-group">
                    <label>å¯¼å…¥/å¯¼å‡ºé…ç½®</label>
                    <div class="button-group">
                        <button class="import-btn" id="importBtn">å¯¼å…¥é…ç½®æ–‡ä»¶</button>
                        <button class="export-btn" id="exportConfigBtn">å¯¼å‡ºå½“å‰é…ç½®</button>
                    </div>
                </div>

                <div class="input-group">
                    <label>å†å²è®°å½•ç®¡ç†</label>
                    <div class="log-content" id="historyList"></div>
                    <div class="button-group">
                        <button class="clear-btn" id="clearHistoryBtn">æ¸…ç©ºå†å²è®°å½•</button>
                    </div>
                </div>
            </div>

            <!-- æ—¥å¿—åŒºåŸŸ -->
            <div class="log-group">
                <div class="log-header">
                    <label>æ“ä½œæ—¥å¿—</label>
                    <div class="log-actions">
                        <button class="log-action-btn" id="clearLogBtn">æ¸…ç©ºæ—¥å¿—</button>
                        <button class="log-action-btn" id="toggleLogBtn">æŠ˜å </button>
                    </div>
                </div>
                <div class="log-content" id="logContent">
                    <div class="log-entry info">
                        <span class="timestamp" id="currentTime"></span>
                        <span>æ¬¢è¿ä½¿ç”¨Clashè®¢é˜…è½¬æ¢å·¥å…· (å…¨è§„åˆ™ç‰ˆ)ï¼</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toasté€šçŸ¥ -->
    <div class="toast" id="toast"></div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
    <input type="file" id="importFile" accept=".json,.txt" style="display: none;">

    <script>
        (function() {
            // ==================== å¸¸é‡å®šä¹‰ ====================
            const STORAGE_KEYS = {
                HISTORY: 'clash_converter_history',
                CONFIG: 'clash_converter_config',
                TEMPLATES: 'clash_converter_templates'
            };
            
            const MAX_HISTORY_ITEMS = 20;
            const MAX_LOG_ENTRIES = 100;
            const CONVERSION_BASE_URL = 'https://url.v1.mk/sub?target=clash&url=';

            // ---------- é‡ç‚¹ï¼šæ ¹æ® https://github.com/ACL4SSR/ACL4SSR/tree/master/Clash/config æå–çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ (ç¼–ç å) ----------
            // æ˜ å°„è§„åˆ™åç§° -> ç¼–ç åçš„URL (ä¿ç•™åŸå§‹æ–‡ä»¶åï¼Œä¾¿äºè¯†åˆ«)
            // é‡‡ç”¨ encodeURIComponent å¯¹åŸå§‹URLç¼–ç ï¼Œä½†é…ç½®å‚æ•°éœ€è¦çš„æ˜¯å®Œæ•´çš„ config= ç¼–ç åçš„URL
            const TEMPLATE_CONFIGS = {
                // åŸºç¡€/ä¸»æµ
                'ACL4SSR_Online': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online.ini',
                'ACL4SSR_Online_Full': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full.ini',
                'ACL4SSR_Online_Mini': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Mini.ini',
                'ACL4SSR_Online_AdblockPlus': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_AdblockPlus.ini',
                'ACL4SSR_Online_NoAuto': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_NoAuto.ini',
                'ACL4SSR_Online_NoReject': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_NoReject.ini',
                'ACL4SSR_Online_Mini_AdblockPlus': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Mini_AdblockPlus.ini',
                'ACL4SSR_Online_Mini_NoAuto': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Mini_NoAuto.ini',
                'ACL4SSR_Online_Full_AdblockPlus': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_AdblockPlus.ini',
                'ACL4SSR_Online_Full_Netflix': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Netflix.ini',
                'ACL4SSR_Online_Full_YouTube': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_YouTube.ini',
                'ACL4SSR_Online_Full_Google': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Google.ini',
                'ACL4SSR_Online_Full_Telegram': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Telegram.ini',
                'ACL4SSR_Online_Full_Spotify': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Spotify.ini',
                'ACL4SSR_Online_Full_Amazon': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Amazon.ini',
                'ACL4SSR_Online_Full_TikTok': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_TikTok.ini',
                'ACL4SSR_Online_Full_DisneyPlus': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_DisneyPlus.ini',
                'ACL4SSR_Online_Full_HBO': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_HBO.ini',
                'ACL4SSR_Online_Full_Apple': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Apple.ini',
                'ACL4SSR_Online_Full_Microsoft': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Microsoft.ini',
                'ACL4SSR_Online_Full_Game': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Game.ini',
                'ACL4SSR_Online_Full_Steam': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Steam.ini',
                'ACL4SSR_Online_Full_Epic': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Epic.ini',
                'ACL4SSR_Online_Full_AI': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_AI.ini',
                'ACL4SSR_Online_Full_GFW': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_GFW.ini',
                'ACL4SSR_Online_Full_Global': 'https%3A%2F%2Fraw.githubusercontent.com%2FACL4SSR%2FACL4SSR%2Fmaster%2FClash%2Fconfig%2FACL4SSR_Online_Full_Global.ini',
                // ä¿ç•™custom
                'custom': null
            };
            
            // ==================== DOMå…ƒç´ å¼•ç”¨ ====================
            const $ = selector => document.getElementById(selector);
            
            // å•é“¾æ¥è½¬æ¢å…ƒç´ 
            const originalUrlInput = $('originalUrl');
            const historyDropdown = $('historyDropdown');
            const emojiCheckbox = $('emojiCheckbox');
            const udpCheckbox = $('udpCheckbox');
            const tfoCheckbox = $('tfoCheckbox');
            const xudpCheckbox = $('xudpCheckbox');
            const scvCheckbox = $('scvCheckbox');
            const convertBtn = $('convertBtn');
            const copyBtn = $('copyBtn');
            const exportBtn = $('exportBtn');
            const clearBtn = $('clearBtn');
            const convertedUrlTextarea = $('convertedUrl');
            const resultStats = $('resultStats');
            const progressFill = $('progressFill');
            
            // æ‰¹é‡è½¬æ¢å…ƒç´ 
            const batchUrlsTextarea = $('batchUrls');
            const batchEmojiCheckbox = $('batchEmojiCheckbox');
            const batchUdpCheckbox = $('batchUdpCheckbox');
            const batchTfoCheckbox = $('batchTfoCheckbox');
            const batchConvertBtn = $('batchConvertBtn');
            const batchCopyBtn = $('batchCopyBtn');
            const batchExportBtn = $('batchExportBtn');
            const batchClearBtn = $('batchClearBtn');
            const batchResults = $('batchResults');
            const batchResultCount = $('batchResultCount');
            const batchProgressFill = $('batchProgressFill');
            
            // é…ç½®ç®¡ç†å…ƒç´ 
            const configTemplateSelect = $('configTemplate');
            const customConfigUrlInput = $('customConfigUrl');
            const importBtn = $('importBtn');
            const exportConfigBtn = $('exportConfigBtn');
            const clearHistoryBtn = $('clearHistoryBtn');
            const historyList = $('historyList');
            
            // æ—¥å¿—å’ŒUIå…ƒç´ 
            const logContent = $('logContent');
            const currentTimeSpan = $('currentTime');
            const clearLogBtn = $('clearLogBtn');
            const toggleLogBtn = $('toggleLogBtn');
            const toast = $('toast');
            const importFileInput = $('importFile');
            
            // æ ‡ç­¾é¡µå…ƒç´ 
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // ==================== çŠ¶æ€ç®¡ç† ====================
            let conversionQueue = [];
            let isProcessing = false;
            let isLogCollapsed = false;
            
            // ==================== æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ====================
            
            const isValidUrl = (urlString) => {
                if (!urlString) return false;
                const pattern = /^(https?|vless|hysteria|trojan|vmess|ss):\/\/[^\s/$.?#].[^\s]*$/i;
                return pattern.test(urlString.trim());
            };
            
            const debounce = (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            };
            
            const throttle = (func, limit) => {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            };
            
            const showToast = (message, type = 'info', duration = 3000) => {
                toast.textContent = message;
                toast.className = `toast ${type}`;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, duration);
            };
            
            const updateTime = () => {
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                currentTimeSpan.textContent = `[${timeString}] `;
            };
            
            const addLogEntry = (message, type = 'info') => {
                if (isLogCollapsed) return;
                
                if (logContent.children.length >= MAX_LOG_ENTRIES) {
                    logContent.removeChild(logContent.firstChild);
                }
                
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                
                const timestampSpan = document.createElement('span');
                timestampSpan.className = 'timestamp';
                timestampSpan.textContent = `[${timeString}] `;
                
                logEntry.appendChild(timestampSpan);
                logEntry.appendChild(document.createTextNode(message));
                
                logContent.appendChild(logEntry);
                logContent.scrollTop = logContent.scrollHeight;
            };
            
            /**
             * è·å–é…ç½®å‚æ•° - å…¨è§„åˆ™ç‰ˆæœ¬ (ä¿®æ”¹configéƒ¨åˆ†)
             */
            const getConfigParams = (useBatch = false) => {
                const template = configTemplateSelect.value;
                let templateConfig = '';
                
                // æ ¹æ®æ¨¡æ¿é€‰æ‹©é…ç½® (ä½¿ç”¨TEMPLATE_CONFIGSæ˜ å°„)
                if (template === 'custom' && customConfigUrlInput.value.trim()) {
                    const customUrl = customConfigUrlInput.value.trim();
                    if (isValidUrl(customUrl)) {
                        templateConfig = `&config=${encodeURIComponent(customUrl)}`;
                    } else {
                        addLogEntry('è‡ªå®šä¹‰é…ç½®URLæ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤æ¨¡æ¿', 'warning');
                        templateConfig = `&config=${TEMPLATE_CONFIGS['ACL4SSR_Online']}`;
                    }
                } else if (TEMPLATE_CONFIGS[template]) {
                    templateConfig = `&config=${TEMPLATE_CONFIGS[template]}`;
                } else {
                    // é»˜è®¤ä½¿ç”¨ACL4SSR_Online
                    templateConfig = `&config=${TEMPLATE_CONFIGS['ACL4SSR_Online']}`;
                }
                
                // åŸºç¡€å‚æ•° (ä¿æŒåŸæœ‰é€»è¾‘)
                const baseParams = '&insert=false&expand=true&fdn=false&new_name=true';
                
                // æ ¹æ®å¤é€‰æ¡†æ·»åŠ å‚æ•°
                const params = [];
                
                if (!useBatch) {
                    if (emojiCheckbox.checked) params.push('emoji=true');
                    if (udpCheckbox.checked) params.push('udp=true');
                    if (tfoCheckbox.checked) params.push('tfo=true');
                    if (xudpCheckbox.checked) params.push('xudp=true');
                    if (scvCheckbox.checked) params.push('scv=true');
                } else {
                    if (batchEmojiCheckbox.checked) params.push('emoji=true');
                    if (batchUdpCheckbox.checked) params.push('udp=true');
                    if (batchTfoCheckbox.checked) params.push('tfo=true');
                }
                
                if (!params.includes('emoji=true')) params.push('emoji=false');
                if (!params.includes('udp=true')) params.push('udp=false');
                if (!params.includes('tfo=true')) params.push('tfo=false');
                if (!params.includes('xudp=true')) params.push('xudp=false');
                if (!params.includes('scv=true')) params.push('scv=false');
                params.push('list=false');
                
                return templateConfig + baseParams + '&' + params.join('&');
            };
            
            const buildConvertedUrl = (originalUrl, useBatch = false) => {
                const encodedUrl = encodeURIComponent(originalUrl);
                const configParams = getConfigParams(useBatch);
                return CONVERSION_BASE_URL + encodedUrl + configParams;
            };
            
            // æœ¬åœ°å­˜å‚¨æ“ä½œ (å¤ç”¨ä¹‹å‰é€»è¾‘)
            const storage = {
                saveHistory: (url) => {
                    try {
                        const history = storage.getHistory();
                        const newHistory = [{
                            url,
                            timestamp: new Date().toISOString(),
                            convertedUrl: buildConvertedUrl(url)
                        }, ...history.filter(item => item.url !== url)].slice(0, MAX_HISTORY_ITEMS);
                        
                        localStorage.setItem(STORAGE_KEYS.HISTORY, JSON.stringify(newHistory));
                        storage.updateHistoryDisplay();
                    } catch (e) {
                        console.warn('ä¿å­˜å†å²è®°å½•å¤±è´¥:', e);
                    }
                },
                
                getHistory: () => {
                    try {
                        return JSON.parse(localStorage.getItem(STORAGE_KEYS.HISTORY) || '[]');
                    } catch (e) {
                        return [];
                    }
                },
                
                clearHistory: () => {
                    try {
                        localStorage.removeItem(STORAGE_KEYS.HISTORY);
                        storage.updateHistoryDisplay();
                        addLogEntry('å†å²è®°å½•å·²æ¸…ç©º', 'success');
                        showToast('å†å²è®°å½•å·²æ¸…ç©º', 'success');
                    } catch (e) {
                        addLogEntry('æ¸…ç©ºå†å²è®°å½•å¤±è´¥', 'error');
                    }
                },
                
                updateHistoryDisplay: () => {
                    const history = storage.getHistory();
                    const historyListContent = $('historyList');
                    historyListContent.innerHTML = '';
                    
                    if (history.length === 0) {
                        historyListContent.innerHTML = '<div class="log-entry info">æš‚æ— å†å²è®°å½•</div>';
                        return;
                    }
                    
                    history.forEach((item, index) => {
                        const entry = document.createElement('div');
                        entry.className = 'log-entry info';
                        
                        const date = new Date(item.timestamp);
                        const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        
                        entry.innerHTML = `
                            <span class="timestamp">[${timeStr}]</span>
                            <span>${item.url.substring(0, 50)}${item.url.length > 50 ? '...' : ''}</span>
                            <button class="history-use-btn" data-url="${item.url}" style="margin-left: 10px; padding: 2px 8px; font-size: 12px; background: #4a00e0; color: white; border: none; border-radius: 4px; cursor: pointer;">ä½¿ç”¨</button>
                        `;
                        
                        historyListContent.appendChild(entry);
                    });
                    
                    document.querySelectorAll('.history-use-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const url = btn.getAttribute('data-url');
                            originalUrlInput.value = url;
                            originalUrlInput.focus();
                            showToast('å†å²é“¾æ¥å·²å¡«å……', 'info');
                        });
                    });
                },
                
                saveConfig: (config) => {
                    try {
                        localStorage.setItem(STORAGE_KEYS.CONFIG, JSON.stringify(config));
                    } catch (e) {
                        console.warn('ä¿å­˜é…ç½®å¤±è´¥:', e);
                    }
                },
                
                loadConfig: () => {
                    try {
                        return JSON.parse(localStorage.getItem(STORAGE_KEYS.CONFIG) || '{}');
                    } catch (e) {
                        return {};
                    }
                }
            };
            
            // ==================== äº‹ä»¶å¤„ç†å‡½æ•° ====================
            
            const handleConvert = async () => {
                const originalUrl = originalUrlInput.value.trim();
                
                if (!originalUrl) {
                    addLogEntry('é”™è¯¯ï¼šè¯·è¾“å…¥è®¢é˜…é“¾æ¥', 'error');
                    showToast('è¯·è¾“å…¥è®¢é˜…é“¾æ¥', 'error');
                    originalUrlInput.focus();
                    return;
                }
                
                if (!isValidUrl(originalUrl)) {
                    addLogEntry('é”™è¯¯ï¼šè¯·è¾“å…¥æœ‰æ•ˆçš„URLé“¾æ¥', 'error');
                    showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„URLé“¾æ¥', 'error');
                    return;
                }
                
                try {
                    convertBtn.classList.add('loading');
                    convertBtn.disabled = true;
                    progressFill.style.width = '30%';
                    
                    addLogEntry('å¼€å§‹è½¬æ¢é“¾æ¥...', 'info');
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    const convertedUrl = buildConvertedUrl(originalUrl);
                    
                    progressFill.style.width = '100%';
                    convertedUrlTextarea.value = convertedUrl;
                    
                    const urlLength = convertedUrl.length;
                    const templateName = configTemplateSelect.options[configTemplateSelect.selectedIndex]?.text || 'æœªçŸ¥æ¨¡æ¿';
                    resultStats.innerHTML = `é•¿åº¦: ${urlLength} å­—ç¬¦ | æ¨¡æ¿: ${templateName}`;
                    
                    storage.saveHistory(originalUrl);
                    
                    addLogEntry('æˆåŠŸï¼šé“¾æ¥å·²è½¬æ¢', 'success');
                    showToast('é“¾æ¥è½¬æ¢æˆåŠŸ', 'success');
                    
                } catch (error) {
                    addLogEntry(`é”™è¯¯ï¼š${error.message}`, 'error');
                    showToast('è½¬æ¢å¤±è´¥', 'error');
                    progressFill.style.width = '0%';
                } finally {
                    convertBtn.classList.remove('loading');
                    convertBtn.disabled = false;
                    
                    setTimeout(() => {
                        progressFill.style.width = '0%';
                    }, 1000);
                }
            };
            
            const handleBatchConvert = async () => {
                const batchText = batchUrlsTextarea.value.trim();
                
                if (!batchText) {
                    addLogEntry('æ‰¹é‡è½¬æ¢é”™è¯¯ï¼šè¯·è¾“å…¥é“¾æ¥åˆ—è¡¨', 'error');
                    showToast('è¯·è¾“å…¥é“¾æ¥åˆ—è¡¨', 'error');
                    return;
                }
                
                const urls = batchText.split('\n')
                    .map(url => url.trim())
                    .filter(url => url && isValidUrl(url));
                
                if (urls.length === 0) {
                    addLogEntry('æ‰¹é‡è½¬æ¢é”™è¯¯ï¼šæœªæ‰¾åˆ°æœ‰æ•ˆçš„URLé“¾æ¥', 'error');
                    showToast('æœªæ‰¾åˆ°æœ‰æ•ˆçš„URLé“¾æ¥', 'error');
                    return;
                }
                
                if (isProcessing) {
                    showToast('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'info');
                    return;
                }
                
                isProcessing = true;
                batchConvertBtn.disabled = true;
                batchConvertBtn.classList.add('loading');
                batchConvertBtn.textContent = 'è½¬æ¢ä¸­...';
                
                batchResults.innerHTML = '';
                batchResultCount.textContent = `(${urls.length}ä¸ªé“¾æ¥)`;
                
                let successCount = 0;
                let errorCount = 0;
                
                batchProgressFill.style.width = '0%';
                
                addLogEntry(`å¼€å§‹æ‰¹é‡è½¬æ¢ï¼Œå…± ${urls.length} ä¸ªé“¾æ¥`, 'info');
                
                for (let i = 0; i < urls.length; i++) {
                    const url = urls[i];
                    
                    try {
                        const progress = ((i + 1) / urls.length) * 100;
                        batchProgressFill.style.width = `${progress}%`;
                        
                        const convertedUrl = buildConvertedUrl(url, true);
                        
                        const resultCard = document.createElement('div');
                        resultCard.className = 'batch-result-item';
                        resultCard.innerHTML = `
                            <div class="batch-result-url">${url.substring(0, 60)}${url.length > 60 ? '...' : ''}</div>
                            <textarea class="batch-result-content" readonly>${convertedUrl}</textarea>
                            <div style="margin-top: 8px; display: flex; gap: 8px;">
                                <button class="copy-single-btn" data-url="${convertedUrl}" style="padding: 4px 8px; font-size: 12px; background: #00b09b; color: white; border: none; border-radius: 4px; cursor: pointer;">å¤åˆ¶</button>
                                <span class="status-badge success-badge">æˆåŠŸ</span>
                            </div>
                        `;
                        
                        batchResults.appendChild(resultCard);
                        successCount++;
                        
                        storage.saveHistory(url);
                        
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        const errorCard = document.createElement('div');
                        errorCard.className = 'batch-result-item';
                        errorCard.innerHTML = `
                            <div class="batch-result-url">${url.substring(0, 60)}${url.length > 60 ? '...' : ''}</div>
                            <div class="batch-result-content" style="color: #dc3545;">è½¬æ¢å¤±è´¥: ${error.message}</div>
                            <div style="margin-top: 8px;">
                                <span class="status-badge error-badge">å¤±è´¥</span>
                            </div>
                        `;
                        
                        batchResults.appendChild(errorCard);
                        errorCount++;
                    }
                }
                
                if (successCount > 0) {
                    const allUrls = Array.from(batchResults.querySelectorAll('.batch-result-content'))
                        .map(textarea => textarea.value)
                        .join('\n\n');
                    
                    batchCopyBtn.onclick = () => handleBatchCopy(allUrls);
                }
                
                batchProgressFill.style.width = '100%';
                
                isProcessing = false;
                batchConvertBtn.disabled = false;
                batchConvertBtn.classList.remove('loading');
                batchConvertBtn.textContent = 'æ‰¹é‡è½¬æ¢';
                
                addLogEntry(`æ‰¹é‡è½¬æ¢å®Œæˆï¼ŒæˆåŠŸ: ${successCount}ï¼Œå¤±è´¥: ${errorCount}`, 
                           errorCount === 0 ? 'success' : 'warning');
                showToast(`æ‰¹é‡è½¬æ¢å®Œæˆï¼ŒæˆåŠŸ ${successCount} ä¸ªï¼Œå¤±è´¥ ${errorCount} ä¸ª`, 
                         errorCount === 0 ? 'success' : 'info');
                
                setTimeout(() => {
                    batchProgressFill.style.width = '0%';
                }, 2000);
            };
            
            const handleCopy = async () => {
                const convertedUrl = convertedUrlTextarea.value;
                
                if (!convertedUrl) {
                    addLogEntry('å¤åˆ¶é”™è¯¯ï¼šæ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
                    showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
                    return;
                }
            
                try {
                    await navigator.clipboard.writeText(convertedUrl);
                    addLogEntry('æˆåŠŸï¼šè½¬æ¢ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } catch (err) {
                    const textArea = document.createElement('textarea');
                    textArea.value = convertedUrl;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    addLogEntry('æˆåŠŸï¼šè½¬æ¢ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆä½¿ç”¨å›é€€æ–¹æ¡ˆï¼‰', 'success');
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }
            };
            
            const handleBatchCopy = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    addLogEntry('æˆåŠŸï¼šæ‰¹é‡è½¬æ¢ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                    showToast('æ‰¹é‡ç»“æœå·²å¤åˆ¶', 'success');
                } catch (err) {
                    addLogEntry('æ‰¹é‡å¤åˆ¶å¤±è´¥', 'error');
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                }
            };
            
            const handleExport = () => {
                const originalUrl = originalUrlInput.value;
                const convertedUrl = convertedUrlTextarea.value;
                
                if (!convertedUrl) {
                    showToast('æ²¡æœ‰å¯å¯¼å‡ºçš„å†…å®¹', 'error');
                    return;
                }
                
                const config = {
                    originalUrl,
                    convertedUrl,
                    config: {
                        emoji: emojiCheckbox.checked,
                        udp: udpCheckbox.checked,
                        tfo: tfoCheckbox.checked,
                        xudp: xudpCheckbox.checked,
                        scv: scvCheckbox.checked,
                        template: configTemplateSelect.value,
                        templateName: configTemplateSelect.options[configTemplateSelect.selectedIndex]?.text,
                        customConfigUrl: customConfigUrlInput.value
                    },
                    timestamp: new Date().toISOString(),
                    version: '1.0.0'
                };
                
                const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `clash-config-${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                addLogEntry('é…ç½®å·²å¯¼å‡º', 'success');
                showToast('é…ç½®å¯¼å‡ºæˆåŠŸ', 'success');
            };
            
            const handleExportConfig = () => {
                const config = {
                    template: configTemplateSelect.value,
                    templateName: configTemplateSelect.options[configTemplateSelect.selectedIndex]?.text,
                    customConfigUrl: customConfigUrlInput.value,
                    timestamp: new Date().toISOString(),
                    version: '1.0.0'
                };
                
                const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `clash-template-config-${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                addLogEntry('æ¨¡æ¿é…ç½®å·²å¯¼å‡º', 'success');
                showToast('æ¨¡æ¿é…ç½®å¯¼å‡ºæˆåŠŸ', 'success');
            };
            
            const handleImport = () => {
                importFileInput.click();
            };
            
            const handleFileImport = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const config = JSON.parse(e.target.result);
                        
                        if (config.originalUrl) originalUrlInput.value = config.originalUrl;
                        if (config.convertedUrl) convertedUrlTextarea.value = config.convertedUrl;
                        
                        if (config.config) {
                            const conf = config.config;
                            emojiCheckbox.checked = conf.emoji || false;
                            udpCheckbox.checked = conf.udp || false;
                            tfoCheckbox.checked = conf.tfo || false;
                            xudpCheckbox.checked = conf.xudp || false;
                            scvCheckbox.checked = conf.scv || false;
                            
                            if (conf.template) {
                                // æ£€æŸ¥é€‰é¡¹æ˜¯å¦å­˜åœ¨
                                const optionExists = Array.from(configTemplateSelect.options).some(opt => opt.value === conf.template);
                                if (optionExists) configTemplateSelect.value = conf.template;
                            }
                            
                            if (conf.customConfigUrl) customConfigUrlInput.value = conf.customConfigUrl;
                        }
                        
                        addLogEntry('é…ç½®å¯¼å…¥æˆåŠŸ', 'success');
                        showToast('é…ç½®å¯¼å…¥æˆåŠŸ', 'success');
                        
                    } catch (error) {
                        addLogEntry('é…ç½®å¯¼å…¥å¤±è´¥: æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                        showToast('å¯¼å…¥å¤±è´¥: æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                    }
                };
                
                reader.readAsText(file);
                importFileInput.value = '';
            };
            
            const handleClear = () => {
                originalUrlInput.value = '';
                convertedUrlTextarea.value = '';
                resultStats.innerHTML = '';
                progressFill.style.width = '0%';
                addLogEntry('è¾“å…¥å†…å®¹å·²æ¸…ç©º', 'info');
                showToast('å·²æ¸…ç©º', 'info');
                originalUrlInput.focus();
            };
            
            const handleBatchClear = () => {
                batchUrlsTextarea.value = '';
                batchResults.innerHTML = '';
                batchResultCount.textContent = '';
                batchProgressFill.style.width = '0%';
                addLogEntry('æ‰¹é‡è¾“å…¥å·²æ¸…ç©º', 'info');
                showToast('æ‰¹é‡è¾“å…¥å·²æ¸…ç©º', 'info');
            };
            
            const handleClearLog = () => {
                logContent.innerHTML = '<div class="log-entry info">æ—¥å¿—å·²æ¸…ç©º</div>';
                addLogEntry('æ—¥å¿—å·²æ¸…ç©º', 'info');
            };
            
            const handleToggleLog = () => {
                isLogCollapsed = !isLogCollapsed;
                toggleLogBtn.textContent = isLogCollapsed ? 'å±•å¼€' : 'æŠ˜å ';
                
                if (isLogCollapsed) {
                    logContent.style.height = '0';
                    logContent.style.padding = '0';
                } else {
                    logContent.style.height = '150px';
                    logContent.style.padding = '15px';
                }
            };
            
            const showHistoryDropdown = () => {
                const history = storage.getHistory();
                
                if (history.length === 0) {
                    historyDropdown.innerHTML = '<div class="history-item">æš‚æ— å†å²è®°å½•</div>';
                    historyDropdown.style.display = 'block';
                    return;
                }
                
                historyDropdown.innerHTML = '';
                
                history.forEach((item) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.textContent = item.url.substring(0, 50) + (item.url.length > 50 ? '...' : '');
                    historyItem.title = item.url;
                    
                    historyItem.addEventListener('click', () => {
                        originalUrlInput.value = item.url;
                        historyDropdown.style.display = 'none';
                        originalUrlInput.focus();
                    });
                    
                    historyDropdown.appendChild(historyItem);
                });
                
                const clearItem = document.createElement('div');
                clearItem.className = 'history-clear';
                clearItem.textContent = 'æ¸…ç©ºå†å²è®°å½•';
                clearItem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    storage.clearHistory();
                    historyDropdown.style.display = 'none';
                });
                
                historyDropdown.appendChild(clearItem);
                historyDropdown.style.display = 'block';
            };
            
            const hideHistoryDropdown = debounce(() => {
                if (!originalUrlInput.matches(':focus')) {
                    historyDropdown.style.display = 'none';
                }
            }, 200);
            
            const handleTabSwitch = (tabId) => {
                tabs.forEach(tab => tab.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                const selectedTab = document.querySelector(`.tab[data-tab="${tabId}"]`);
                const selectedContent = $(`${tabId}-tab`);
                
                if (selectedTab && selectedContent) {
                    selectedTab.classList.add('active');
                    selectedContent.classList.add('active');
                }
            };
            
            // äº‹ä»¶ç›‘å¬å™¨
            convertBtn.addEventListener('click', handleConvert);
            copyBtn.addEventListener('click', handleCopy);
            exportBtn.addEventListener('click', handleExport);
            clearBtn.addEventListener('click', handleClear);
            
            batchConvertBtn.addEventListener('click', handleBatchConvert);
            batchClearBtn.addEventListener('click', handleBatchClear);
            
            importBtn.addEventListener('click', handleImport);
            exportConfigBtn.addEventListener('click', handleExportConfig);
            clearHistoryBtn.addEventListener('click', storage.clearHistory);
            importFileInput.addEventListener('change', handleFileImport);
            
            clearLogBtn.addEventListener('click', handleClearLog);
            toggleLogBtn.addEventListener('click', handleToggleLog);
            
            originalUrlInput.addEventListener('focus', showHistoryDropdown);
            originalUrlInput.addEventListener('input', debounce(() => {
                if (originalUrlInput.value.trim()) {
                    showHistoryDropdown();
                } else {
                    historyDropdown.style.display = 'none';
                }
            }, 300));
            
            document.addEventListener('click', (e) => {
                if (!originalUrlInput.contains(e.target) && !historyDropdown.contains(e.target)) {
                    historyDropdown.style.display = 'none';
                }
            });
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    handleTabSwitch(tabId);
                    addLogEntry(`åˆ‡æ¢åˆ° ${tab.textContent} æ ‡ç­¾`, 'info');
                });
            });
            
            originalUrlInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    handleConvert();
                }
            });
            
            batchResults.addEventListener('click', (e) => {
                if (e.target.classList.contains('copy-single-btn')) {
                    const url = e.target.getAttribute('data-url');
                    navigator.clipboard.writeText(url).then(() => {
                        showToast('å•ä¸ªç»“æœå·²å¤åˆ¶', 'success');
                    });
                }
            });
            
            // åˆå§‹åŒ–
            const init = () => {
                updateTime();
                setInterval(updateTime, 1000);
                
                storage.updateHistoryDisplay();
                
                const savedConfig = storage.loadConfig();
                if (savedConfig.template) {
                    // æ£€æŸ¥æœ‰æ•ˆæ€§
                    const optionExists = Array.from(configTemplateSelect.options).some(opt => opt.value === savedConfig.template);
                    if (optionExists) configTemplateSelect.value = savedConfig.template;
                }
                
                if (savedConfig.customConfigUrl) {
                    customConfigUrlInput.value = savedConfig.customConfigUrl;
                }
                
                configTemplateSelect.addEventListener('change', () => {
                    const templateName = configTemplateSelect.options[configTemplateSelect.selectedIndex]?.text || 'æœªçŸ¥';
                    addLogEntry(`åˆ‡æ¢åˆ° ${templateName} æ¨¡æ¿`, 'info');
                    
                    storage.saveConfig({
                        template: configTemplateSelect.value,
                        customConfigUrl: customConfigUrlInput.value
                    });
                });
                
                customConfigUrlInput.addEventListener('input', debounce(() => {
                    storage.saveConfig({
                        template: configTemplateSelect.value,
                        customConfigUrl: customConfigUrlInput.value
                    });
                }, 500));
                
                addLogEntry('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ (å…¨è§„åˆ™ç‰ˆ)', 'success');
                addLogEntry('å·²é›†æˆACL4SSRä»“åº“å…¨éƒ¨é…ç½®æ¨¡æ¿', 'info');
            };
            
            document.addEventListener('DOMContentLoaded', init);
        })();
    </script>
</body>

</html>
